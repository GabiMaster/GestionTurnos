<!DOCTYPE html>
<html lang="es" x-data="spaApp()" x-init="init()">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReservIt SPA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</head>
<body class="bg-light">
    <main class="container-fluid py-4">
        <!-- Login Page -->
        <section x-show="page==='login'" class="row justify-content-center align-items-center min-vh-100">
            <div class="col-12 col-sm-10 col-md-7 col-lg-5 col-xl-4">
                <div class="card shadow-lg border-0 p-4">
                    <h2 class="mb-4 text-center">Iniciar sesión</h2>
                    <form @submit.prevent="login">
                        <div class="mb-3">
                            <input type="text" x-model="loginData.email" class="form-control" placeholder="Email" required>
                        </div>
                        <div class="mb-3">
                            <input type="password" x-model="loginData.password" class="form-control" placeholder="Contraseña" required>
                        </div>
                        <div class="d-grid mb-2">
                            <button type="submit" class="btn btn-primary btn-lg">Ingresar</button>
                        </div>
                    </form>
                    <div x-text="loginMessage" class="alert alert-danger text-center mt-2" x-show="loginMessage"></div>
                    <div class="text-center mt-3">
                        <a href="#" @click.prevent="goTo('register')">¿No tienes cuenta? Regístrate</a>
                    </div>
                </div>
            </div>
        </section>
        <!-- Register Page -->
        <section x-show="page==='register'" class="row justify-content-center align-items-center min-vh-100">
            <div class="col-12 col-sm-10 col-md-7 col-lg-5 col-xl-4">
                <div class="card shadow-lg border-0 p-4">
                    <h2 class="mb-4 text-center">Registro</h2>
                    <form @submit.prevent="register">
                        <div class="mb-3">
                            <input type="text" x-model="registerData.nombre" class="form-control" placeholder="Nombre" required>
                        </div>
                        <div class="mb-3">
                            <input type="email" x-model="registerData.email" class="form-control" placeholder="Email" required>
                        </div>
                        <div class="mb-3">
                            <input type="password" x-model="registerData.password" class="form-control" placeholder="Contraseña" required>
                        </div>
                        <div class="d-grid mb-2">
                            <button type="submit" class="btn btn-success btn-lg">Registrarse</button>
                        </div>
                    </form>
                    <div x-text="registerMessage" class="alert alert-info text-center mt-2" x-show="registerMessage"></div>
                    <div class="text-center mt-3">
                        <a href="#" @click.prevent="goTo('login')">¿Ya tienes cuenta? Inicia sesión</a>
                    </div>
                </div>
            </div>
        </section>
        <!-- Main Page: Servicios y Turnos -->
        <section x-show="page==='main'" class="row justify-content-center py-3">
            <div class="col-12 col-lg-10 col-xl-9">
                <div class="row g-4">
                    <div class="col-12 col-md-7">
                        <div class="card shadow-lg border-0 p-4 mb-4 h-100">
                            <h2 class="mb-4">Servicios Disponibles</h2>
                            <div x-show="servicios.length === 0" class="alert alert-warning">No hay servicios disponibles.</div>
                            <ul class="list-group mb-3">
                                <template x-for="s in servicios" :key="s.id">
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <span>
                                            <strong x-text="s.nombre"></strong> <span class="text-muted">- <span x-text="s.duracionMinutos + ' min'"></span></span>
                                        </span>
                                        <button @click="selectServicio(s.id)" class="btn btn-outline-primary btn-sm">Agendar</button>
                                    </li>
                                </template>
                            </ul>
                            <div x-show="selectedServicio">
                                <h4>Agendar turno</h4>
                                <input type="datetime-local" x-model="nuevoTurno.fechaHora" class="form-control mb-2">
                                <button @click="agendarTurno" class="btn btn-primary" :disabled="loading || !nuevoTurno.fechaHora">Agendar</button>
                                <div x-text="turnoMensaje" class="alert alert-info mt-2" x-show="turnoMensaje"></div>
                                <template x-if="qrUrl">
                                    <div class="mt-3 text-center">
                                        <h5>QR generado</h5>
                                        <img :src="qrUrl" alt="QR generado" style="width:200px;height:200px;" />
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-5">
                        <div class="card shadow-lg border-0 p-4 h-100">
                            <h2 class="mb-4">Mis Turnos</h2>
                            <div x-show="turnos.length === 0" class="alert alert-secondary">No tienes turnos agendados.</div>
                            <ul class="list-group">
                                <template x-for="t in turnos" :key="t.id">
                                    <li class="list-group-item d-flex justify-content-between align-items-center">
                                        <span>
                                            <span x-text="t.fechaHora"></span> - <span x-text="t.servicioNombre"></span>
                                        </span>
                                        <button @click="cancelarTurno(t.id)" class="btn btn-outline-danger btn-sm">Cancelar</button>
                                    </li>
                                </template>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
